@model ZoomLa.SQLDAL.SQL.PageSetting
@{
	Layout = "~/Areas/Admin/Views/Shared/_layout.cshtml";
    int issmall = ViewBag.issmall;
}
@section head{
    <title>选择试题</title>
}
@section content{

    <div class="container-fluid">
        <div>
			<div class="input-group mb-3 w-100">
			<input type="text" id="skey" name="skey" class="form-control mvcparam max20rem" placeholder="试题标题" />
			<div class="input-group-prepend">
			<span class="input-group-text">
			<button type="button" id="search_b" class="btn btn-outline-secondary" onclick="mvcpage.load();"><span class="zi zi_search"></span></button>
			</span>
			<span class="input-group-text">
                    @if (issmall == 1)
                    { <input type="button" id="largesel_b" class="btn btn-outline-info" onclick="mvcpage.bat({ url: 'paper_addlarge', after: 'addLarge' })" value="确定" />   }
                    else { <input type="button" id="sel_b" class="btn btn-outline-info" onclick="mvcpage.bat({ url:'paper_addqids?pid=@Context.Request.GetParam("PID")',after:'add'});" value="确定" /> }
                    <input type="button" class="btn btn-outline-info" onclick="top.CLoseDIag()" value="取消" />
			</span>
			</div>
			</div>
        </div>
        <ul class="nav nav-tabs margin_t5">
            <li class="nav-item" id="tab_99"><a class="nav-link" href="#tab-1" data-toggle="tab" onclick="ShowTabs(99)">所有试题</a></li>
            <li class="nav-item" id="tab_0"><a class="nav-link" href="#tab0" data-toggle="tab" onclick="ShowTabs(0)">单选题</a></li>
            <li class="nav-item" id="tab_1"><a class="nav-link" href="#tab1" data-toggle="tab" onclick="ShowTabs(1)">多选题</a></li>
            <li class="nav-item" id="tab_2"><a class="nav-link" href="#tab2" data-toggle="tab" onclick="ShowTabs(2)">填空题</a></li>
            <li class="nav-item" id="tab_3"><a class="nav-link" href="#tab3" data-toggle="tab" onclick="ShowTabs(3)">解析题</a></li>
            <li class="nav-item" id="tab_4"><a class="nav-link" href="#tab3" data-toggle="tab" onclick="ShowTabs(4)">完形填空</a></li>
            <li class="nav-item" id="tab_10"><a class="nav-link" href="#tab10" data-toggle="tab" onclick="ShowTabs(10)">大题</a></li>
        </ul>
        @Html.Partial("SelQuestion_List", Model)
        <input type="hidden" id="SelIds_Hid" name="SelIds_Hid" value="@ViewBag.selids" />
    </div>
<script>
//导航处理
	//$("#usernav1 ul li").removeClass("active").siblings().eq(3).addClass("active");
</script>	
}
@section script{
    <script>
        $(function () {
            $("input[name=idchk]").click(function () {
                if ($(this)[0].checked) {
                    $("#SelIds_Hid").val($("#SelIds_Hid").val() + "," + $(this).val() + ",");
                } else {
                    $("#SelIds_Hid").val($("#SelIds_Hid").val().replace("," + $(this).val() + ",", ","));
                }
            });
            $("#AllID_Chk").click(function () {
                $("input[name=idchk]").each(function (i, v) {
                    var $tr = $(v).closest("tr");
                    if ($(v)[0].checked) {
                        if ($("#SelIds_Hid").val().indexOf("," + $(v).val() + ",") < 0)//判断是否存在该id
                            $("#SelIds_Hid").val($("#SelIds_Hid").val() + "," + $(v).val() + ",");
                    } else {
                        $("#SelIds_Hid").val($("#SelIds_Hid").val().replace("," + $(v).val() + ",", ","));
                    }
                });
            });
            var issmall = '@issmall';
            if (issmall == '1') { DisTab(10); }
            ActiveTab('@ViewBag.qtype');
        });
        function ActiveTab(id) {
            $("#tab_" + id).find("a").addClass("active");
        }
        function ShowTabs(id) {
            location.href = "SelQuestion?qtype=" + id + "&pid=@Context.Request.GetParam("pid")&issmall=@issmall&selids=" + $("#SelIds_Hid").val();
        }
        function CloseDIag() {
            parent.CLoseDIag();
        }
        function DisTab(id) {
            $("#tab_" + id).remove();
        }
        function SelQuestion(qids, qtitle) {
            parent.GetQuestion(qids, qtitle);
        }
        function addLarge(json) {
            parent.SelQuestion(JSON.parse(json));
        }
        function add() {
            parent.CLoseDIag();
        }
    </script>
}